<div class="d-flex flex-column gap-2 dh-crit-config-modal">
    <p class="notes">
        <i class="fas fa-info-circle"></i>
        Manage critical configurations. Default entries cannot be deleted. Create custom configurations for specific players or adversaries.
    </p>

    <div class="config-list">
        <div class="default-entries-container">
            {{#each configurations as |config|}}
            {{#if config.isDefault}}
            <div class="config-entry default-entry" data-id="{{config.id}}">
                <div class="entry-row">
                    <!-- Hidden fields -->
                    <input type="hidden" name="config_{{config.id}}.id" value="{{config.id}}">
                    <input type="hidden" name="config_{{config.id}}.type" value="{{config.type}}">
                    <input type="hidden" name="config_{{config.id}}.isDefault" value="{{config.isDefault}}">
                    <input type="hidden" name="config_{{config.id}}.createdAt" value="{{config.createdAt}}">
                    <input type="hidden" name="config_{{config.id}}.triggerType" value="Action and Reaction">
                    {{#if (eq config.type "Player Character")}}
                    <input type="hidden" name="config_{{config.id}}.userId" value="{{config.userId}}">
                    {{else}}
                    <input type="hidden" name="config_{{config.id}}.adversaryId" value="{{config.adversaryId}}">
                    {{/if}}

                    <!-- Name as Label (static text) -->
                    <div class="entry-field name-field">
                        <label class="config-name-label">
                            {{#if (eq config.id "default-player-character")}}
                                Default Player Character
                            {{else if (eq config.id "default-adversary")}}
                                Default Adversary
                            {{else}}
                                {{config.name}}
                            {{/if}}
                        </label>
                    </div>

                    <!-- Action Buttons -->
                    <div class="entry-actions">
                        <button type="button" class="action-btn" data-action="text" data-id="{{config.id}}" title="Text Configuration">
                            <i class="fas fa-font"></i>
                        </button>
                        <button type="button" class="action-btn" data-action="fx" data-id="{{config.id}}" title="FX Configuration">
                            <i class="fas fa-bolt"></i>
                        </button>
                        <button type="button" class="action-btn" data-action="sound" data-id="{{config.id}}" title="Sound Configuration">
                            <i class="fas fa-music"></i>
                        </button>
                        <button type="button" class="action-btn" data-action="art" data-id="{{config.id}}" title="Art Configuration">
                            <i class="fas fa-palette"></i>
                        </button>
                        <button type="button" class="action-btn" data-action="preview" data-id="{{config.id}}" title="Preview">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                </div>
            </div>
            {{/if}}
            {{/each}}
        </div>

        {{#each configurations as |config|}}
        {{#unless config.isDefault}}
        <div class="config-entry" data-id="{{config.id}}">
            <div class="entry-row">
                <!-- Hidden fields -->
                <input type="hidden" name="config_{{config.id}}.id" value="{{config.id}}">
                <input type="hidden" name="config_{{config.id}}.isDefault" value="{{config.isDefault}}">
                <input type="hidden" name="config_{{config.id}}.createdAt" value="{{config.createdAt}}">

                <!-- Type -->
                <div class="entry-field type-field">
                    <label>Type</label>
                    <select name="config_{{config.id}}.type">
                        <option value="Player Character" {{#if (eq config.type "Player Character")}}selected{{/if}}>Player Character</option>
                        <option value="Adversary" {{#if (eq config.type "Adversary")}}selected{{/if}}>Adversary</option>
                    </select>
                </div>

                <!-- User/Adversary Selection -->
                <div class="entry-field selection-field">
                    {{#if (eq config.type "Player Character")}}
                        <label>User</label>
                        <select name="config_{{config.id}}.userId" data-current-user="{{config.userId}}">
                            <option value="all">All</option>
                            {{#each @root.nonGMUsers as |user|}}
                            <option value="{{user.id}}">
                                {{user.name}}
                            </option>
                            {{/each}}
                        </select>
                    {{else}}
                        <label>Adversary {{#if config.adversaryId}}(Single){{else}}(All){{/if}}</label>
                        <div class="adversary-drop-zone" data-config-id="{{config.id}}">
                            {{#if config.adversaryId}}
                                <span class="adversary-name">{{#if config.adversaryName}}{{config.adversaryName}}{{else}}{{config.adversaryId}}{{/if}}</span>
                                <button type="button" class="clear-adversary-btn" data-id="{{config.id}}">
                                    <i class="fas fa-times"></i>
                                </button>
                            {{else}}
                                <span class="placeholder">Drag an Adversary here</span>
                            {{/if}}
                        </div>
                        <input type="hidden" name="config_{{config.id}}.adversaryId" value="{{config.adversaryId}}">
                    {{/if}}
                </div>

                <!-- Trigger Type -->
                <div class="entry-field trigger-type-field">
                    <label>Trigger Type</label>
                    <select name="config_{{config.id}}.triggerType" class="trigger-type-select" data-config-type="{{config.type}}">
                        <option value="Action and Reaction" {{#if (eq config.triggerType "Action and Reaction")}}selected{{/if}}>Action and Reaction</option>
                        <option value="Only Action" {{#if (eq config.triggerType "Only Action")}}selected{{/if}}>Only Action</option>
                        <option value="Only Reaction" {{#if (eq config.triggerType "Only Reaction")}}selected{{/if}}>Only Reaction</option>
                        {{#if (eq config.type "Adversary")}}
                        <option value="Fumble" {{#if (eq config.triggerType "Fumble")}}selected{{/if}}>Fumble</option>
                        {{/if}}
                        {{#if (eq config.type "Player Character")}}
                        <option value="Level Up" {{#if (eq config.triggerType "Level Up")}}selected{{/if}}>Level Up</option>
                        {{/if}}
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="entry-actions">
                    <button type="button" class="action-btn" data-action="text" data-id="{{config.id}}" title="Text Configuration">
                        <i class="fas fa-font"></i>
                    </button>
                    <button type="button" class="action-btn" data-action="fx" data-id="{{config.id}}" title="FX Configuration">
                        <i class="fas fa-bolt"></i>
                    </button>
                    <button type="button" class="action-btn" data-action="sound" data-id="{{config.id}}" title="Sound Configuration">
                        <i class="fas fa-music"></i>
                    </button>
                    <button type="button" class="action-btn" data-action="art" data-id="{{config.id}}" title="Art Configuration">
                        <i class="fas fa-palette"></i>
                    </button>
                    <button type="button" class="action-btn" data-action="preview" data-id="{{config.id}}" title="Preview">
                        <i class="fas fa-play"></i>
                    </button>
                    <button type="button" class="delete-entry-btn" data-id="{{config.id}}" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
        {{/unless}}
        {{/each}}
    </div>

    <div class="form-footer">
        <button type="button" class="add-entry-btn">
            <i class="fas fa-plus"></i> Add Configuration
        </button>
        <button type="submit">
            <i class="fas fa-save"></i> Save Changes
        </button>
    </div>
</div>
